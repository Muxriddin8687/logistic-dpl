<div class="container py-4">
    <h3 class="text-center">Get Freight Quote</h3>

    <form #f="ngForm" (submit)="send(f)">
        <div class="row my-5">

            <!-- from -->
            <div class="col-11 col-sm-10 col-md-6 mx-auto">
                <mat-form-field class="w-100">
                    <mat-label>{{ 'form.pickup' | translate }}</mat-label>
                    <input type="text" placeholder="City or ZIP" aria-label="Number" matInput ngModel #inputFrom
                        (input)="findCityByZipCodeFrom(inputFrom.value)" [matAutocomplete]="from" name="from" required
                        minlength="5">

                    <mat-autocomplete #from="matAutocomplete">
                        <mat-option
                            [value]="searchResultFrom().city + ', ' + searchResultFrom().state + ' ' + inputFrom.value">
                            {{ searchResultFrom().city }}
                        </mat-option>
                    </mat-autocomplete>
                </mat-form-field>
            </div>

            <!-- to -->
            <div class="col-11 col-sm-10 col-md-6 mx-auto">
                <mat-form-field class="w-100">
                    <mat-label>{{ 'form.destination' | translate }}</mat-label>
                    <input type="text" placeholder="City or ZIP" aria-label="Number" matInput #inputTo
                        (input)="findCityByZipCodeTo(inputTo.value)" [matAutocomplete]="to" ngModel name="to" required
                        minlength="5">

                    <mat-autocomplete #to="matAutocomplete">
                        <mat-option
                            [value]="searchResultTo().city + ', ' + searchResultTo().state + ' ' + inputTo.value">
                            {{ searchResultTo().city }}
                        </mat-option>
                    </mat-autocomplete>
                </mat-form-field>
            </div>


            <!-- product group -->
            <section id="products">

                <div class="shadow border bg-light rounded w-100 p-3 mb-5">

                    <h5>{{ 'form.productGroup' | translate }}</h5>

                    <hr class="my-4">

                    <div class="table-responsive">
                        <table class="table table-hover table-sm align-middle mb-0">

                            <thead>
                                <tr>
                                    <th width="42px">{{ 'form.type' | translate }}</th>
                                    <th>{{ 'form.productName' | translate }}</th>
                                    <th class="number-input">{{ 'form.length' | translate }}</th>
                                    <th class="number-input">{{ 'form.width' | translate }}</th>
                                    <th class="number-input">{{ 'form.height' | translate }}</th>
                                    <th class="number-input">{{ 'form.weight' | translate }}</th>
                                    <th class="number-input">{{ 'form.quantity' | translate }}</th>
                                    <th width="111px">{{ 'form.stack' | translate }}</th>
                                </tr>
                            </thead>

                            <tbody>

                                <tr *ngFor="let item of userProducts; trackBy: trackByFn">

                                    <td>
                                        <img [src]="item.product[0]['icon']" class="h-100" alt="Product icon">
                                    </td>

                                    <td>
                                        <div class="form-outline">
                                            <input type="text" class="form-control form-sm" [(ngModel)]="item.name"
                                                name="productName" />
                                        </div>
                                    </td>

                                    <td class="number-input"
                                        *ngIf="item.product[0]['parametrs'][0]['value'] != undefined; else undefinedValue">
                                        <div class="form-outline">
                                            <span class="trailing">inc</span>
                                            <input type="text" class="form-control form-sm form-icon-trailing"
                                                name="length" [(ngModel)]="item.product[0]['parametrs'][0]['value']" />
                                        </div>
                                    </td>

                                    <ng-template #undefinedValue>
                                        <td class="number-input">
                                            <div class="form-outline">
                                                <span class="trailing">inc</span>
                                                <input type="text" class="form-control form-sm form-icon-trailing"
                                                    value="" readonly />
                                            </div>
                                        </td>
                                    </ng-template>

                                    <td class="number-input">
                                        <div class="form-outline">
                                            <span class="trailing">inc</span>
                                            <input type="text" class="form-control form-sm form-icon-trailing"
                                                name="width" [(ngModel)]="item.product[0]['parametrs'][1]['value']" />
                                        </div>
                                    </td>

                                    <td class="number-input">
                                        <div class="form-outline">
                                            <span class="trailing">inc</span>
                                            <input type="text" class="form-control form-sm form-icon-trailing"
                                                name="height" [(ngModel)]="item.product[0]['parametrs'][2]['value']" />
                                        </div>
                                    </td>

                                    <td class="number-input">
                                        <div class="form-outline">
                                            <span class="trailing">lbs</span>
                                            <input type="text" class="form-control form-sm form-icon-trailing"
                                                name="weight" [(ngModel)]="item.product[0]['parametrs'][3]['value']" />
                                        </div>
                                    </td>

                                    <td class="number-input">
                                        <div class="form-outline">
                                            <input type="text" class="form-control form-sm" name="quantity"
                                                [(ngModel)]="item.product[0]['parametrs'][4]['value']" />
                                        </div>
                                    </td>

                                    <td class="d-flex">
                                        <button (click)="editProduct(item.id)" type="button"
                                            data-mdb-target="#addProductModal"
                                            class="btn btn-sm btn-secondary btn-rounded px-3" data-mdb-toggle="modal">
                                            <i class="fa fa-pencil"></i>
                                        </button>
                                        <button (click)="deleteProduct(item.id)" type="button"
                                            class="btn btn-danger btn-sm btn-rounded py-2 ms-2">
                                            <i class="fa fa-trash-alt"></i>
                                        </button>
                                    </td>
                                </tr>
                            </tbody>

                            <tfoot>
                                <tr>
                                    <td colspan="8" class="border-bottom-0 ps-0">
                                        <button (click)="selectEvet = true" class="btn btn-secondary" type="button"
                                            data-mdb-toggle="modal" data-mdb-target="#addProductModal">
                                            <i class="fa fa-plus me-2"></i> {{ 'form.addProduct' | translate }}
                                        </button>
                                    </td>
                                </tr>
                            </tfoot>

                        </table>
                    </div>
                </div>


                <div >
                    <div *ngFor="let item of user_truck">
                        <div class="select-truck" style="width: 250px;">
                            <img [src]="'./assets/images/fright-form/' + item.image" class="w-100" alt="Container img">
                            <h6>{{ item.type }}</h6>
                        </div>
                    </div>
                </div>
                <div class="mt-3">
                    <button type="button" class="btn btn-warning" data-mdb-toggle="modal"
                        data-mdb-target="#addTruckModal">
                        Choose truck
                    </button>
                    <button type="reset" (click)="userProducts = []; user_truck = [];" class="btn btn-secondary mx-1">
                        Reset form
                    </button>
                    <button type="submit" class="btn btn-warning">
                        Submit
                    </button>
                </div>
            </section>



        </div>
    </form>

</div>




<!-- add product form modal -->
<div class="modal fade" id="addProductModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-xl">
        <div class="modal-content">
            <div class="modal-body">
                <div id="product-form" class="container py-4">

                    <h3 [class.d-none]="selectEvet == false" class="text-center mb-3">{{
                        'form.addProduct' | translate }}</h3>
                    <h3 [class.d-none]="selectEvet == true" class="text-center mb-3">Edit product
                        details</h3>

                    <div class="row">
                        <ng-container *ngFor="let item of productList">
                            <div class="col" (click)="selectedProduct(item.id)">
                                <div class="product-item" [class.active]="selectedProductNumber == item.id">
                                    <img [src]="item.icon" alt="product icon">
                                    <h6 class="text-center">{{ item.name }}</h6>
                                </div>
                            </div>
                        </ng-container>
                    </div>


                    <div class="row my-5" *ngFor="let item of selectedProductList$ | async">

                        <div class="col-12 col-sm-10 col-md-4 mx-auto me-md-auto">
                            <div class="p-4">
                                <img [src]="item['product'][0]['image']" class="w-100" alt="product-img">
                            </div>
                        </div>

                        <div class="col-12 col-sm-10 col-md-6 mx-auto h-100 px-0">
                            <form #prodForm="ngForm">

                                <div class="row w-100 mx-auto">

                                    <div class="col-12 mb-3">
                                        <span>{{ 'form.productName' | translate }}</span>
                                        <div class="form-outline mb-3">
                                            <input [(ngModel)]="item.name" name="product_name" required type="text"
                                                class="form-control form-sm rounded-pill" />
                                        </div>
                                    </div>

                                    <input type="hidden" name="product_id" [(ngModel)]="item['id']">
                                    <input type="hidden" name="product_type_id" [(ngModel)]="item['product'][0]['id']">

                                    <ng-container *ngFor="let param of item['product'][0]['parametrs']">
                                        <div *ngIf="param.value != undefined" class="col-6 col-sm-6 col-md-6 col-lg-4">
                                            <span>{{ param.label }}</span>
                                            <div class="form-outline mb-3">
                                                <span *ngIf="param.unity != undefined" class="trailing">{{
                                                    param.unity }}</span>
                                                <input [(ngModel)]="param.value" name="{{ param.name }}" required
                                                    type="text"
                                                    class="form-control form-sm form-icon-trailing rounded-pill" />
                                            </div>
                                        </div>
                                    </ng-container>

                                </div>


                                <div class="d-flex">
                                    <button class="btn-secondary btn w-100 me-3" (click)="selectedProduct(1)"
                                        type="button" data-mdb-dismiss="modal">
                                        {{ 'form.cancel' | translate }}</button>
                                    <button data-mdb-dismiss="modal" (click)="addProduct(prodForm)" type="button"
                                        class="btn-theme w-100">
                                        <span>{{ 'form.send' | translate }}</span>
                                        <span>{{ 'form.send' | translate }}</span>
                                        {{ 'form.send' | translate }}
                                    </button>
                                </div>

                            </form>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>




<!-- trck model -->
<div class="modal fade" id="addTruckModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-xl">
        <div class="modal-content">
            <div class="modal-body">

                <h5 class="mt-5">{{ 'form.trucks' | translate }}</h5>

                <div class="row">
                    <ng-container *ngFor="let item of truck_list">
                        <div class="col-11 col-sm-6 col-md-4 col-lg-3 col-xl-2 mx-auto mb-4">
                            <div class="select-truck" [class.active]="user_truck[0]['id'] != undefined && item.id == user_truck[0]['id']"
                                (click)="selectedTruck(item.id)">
                                <img [src]="'./assets/images/fright-form/' + item.image" alt="Container img">
                                <h6>{{ item.type }}</h6>
                            </div>
                        </div>
                    </ng-container>
                </div>


                <h5 class="mt-5">{{ 'form.trailers' | translate }}</h5>

                <div class="row">
                    <ng-container *ngFor="let item of container_list">
                        <div class="col-11 col-sm-6 col-md-4 col-lg-3 col-xl-2 mx-auto mb-4">
                            <div class="select-truck" [class.active]="user_truck[0]['id'] != undefined && item.id == user_truck[0]['id']"
                                (click)="selectedTruck(item.id)">
                                <img [src]="'./assets/images/fright-form/' + item.image" alt="Container img">
                                <h6>{{ item.type }}</h6>
                            </div>
                        </div>
                    </ng-container>
                </div>

            </div>
        </div>
    </div>
</div>